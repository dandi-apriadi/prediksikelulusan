{% include 'header.html' %}
<body>
<div class="wrapper">
    {% include 'sidebar.html' %}
    <div class="main-panel">
        {% include 'navbar.html' %}

        <div class="container">
            <div class="page-inner">
                <div class="page-header">
                    {% if nim_filter %}
                        <h3 class="fw-bold mb-3">Riwayat Prediksi untuk NIM: {{ nim_filter }}</h3>
                    {% else %}
                        <h3 class="fw-bold mb-3">Riwayat Prediksi</h3>
                    {% endif %}

                </div>

                <div class="row mb-3">
                    <div class="col-md-3">
                        <label for="filterStatus" class="form-label">Filter Status</label>
                        <select id="filterStatus" class="form-select form-select-sm">
                            <option value="">Semua Status</option>
                            {% for status in statuses %}
                            <option value="{{ status }}">{{ status }}</option>
                            {% endfor %}
                        </select>
                    </div>
                    <div class="col-md-3">
                        <label for="filterSemester" class="form-label">Filter Semester</label>
                        <select id="filterSemester" class="form-select form-select-sm">
                            <option value="">Semua Semester</option>
                            {% for semester in semesters %}
                            <option value="{{ semester }}">Semester {{ semester }}</option>
                            {% endfor %}
                        </select>
                    </div>
                </div>

                <div class="card">
                    <div class="card-body">
                        <div class="table-responsive">
                            <table id="historyTable" class="table table-striped table-bordered" style="width:100%">
                                <thead>
                                    <tr>
                                        <th>Tanggal</th>
                                        <th>NIM</th>
                                        <th>Nama</th>
                                        <th>Semester</th>
                                        <th>Prediksi</th>
                                        {% if session.role in ['admin', 'kaprodi'] %}
                                        <th>Dibuat Oleh</th>
                                        {% endif %}
                                        <th>Aksi</th> </tr>
                                </thead>
                                <tbody>
                                    {% for r in riwayat %}
                                    <tr>
                                        <td>{{ r.DateTime_str }}</td>
                                        <td>{{ r.NIM }}</td>
                                        <td>{{ r.Nama }}</td>
                                        <td>{{ r.Semester }}</td>
                                        <td>
                                            {% if r.Prediksi == "Lulus" %}
                                                <span class="badge bg-success">{{ r.Prediksi }}</span>
                                            {% else %}
                                                <span class="badge bg-danger">{{ r.Prediksi }}</span>
                                            {% endif %}
                                        </td>
                                        {% if session.role in ['admin', 'kaprodi'] %}
                                        <td>{{ r.Submitted_by }}</td>
                                        {% endif %}
                                        <td>
                                            <a href="{{ url_for('view_prediction_detail', id=r._id) }}" class="btn btn-info btn-sm" title="Lihat Detail">
                                                <i class="fa fa-eye"></i>
                                            </a>
                                        </td>
                                    </tr>
                                    {% endfor %}
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

            </div>
        </div>
        {% include 'footer.html' %}
    </div>
</div>

<script>
$(document).ready(function () {
    let table = $('#historyTable').DataTable({
        responsive: true,
        pageLength: 10,
        order: [[0, 'desc']],
        language: {
            url: "//cdn.datatables.net/plug-ins/1.13.6/i18n/id.json"
        }
    });

    //Logika untuk filter dropdown
    $('#filterStatus').on('change', function () {
        table.column(4).search(this.value).draw();
    });

    $('#filterSemester').on('change', function () {
        table.column(3).search(this.value).draw();
    });
});
</script>
</body>
</html>